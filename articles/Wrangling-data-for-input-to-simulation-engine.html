<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wrangling data for input to simulation engine • rsims</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Wrangling data for input to simulation engine">
<meta property="og:description" content="rsims">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rsims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Wrangling-data-for-input-to-simulation-engine.html">Wrangling data for input to simulation engine</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Wrangling-data-for-input-to-simulation-engine_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Wrangling data for input to simulation engine</h1>
            
      
      
      <div class="hidden name"><code>Wrangling-data-for-input-to-simulation-engine.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>cash_backtest</code> is a reasonably well-optimised event-driven backtesting engine. In testing, it processed an 80-asset, 2300-day backtest in less than 150 milliseconds.</p>
<p>It was built with speed in mind, which required trading off certain conveniences such as holding weights and prices in long-format dataframes indexed by a human-readable timestamp. Instead, it requires the user to ensure their input data meets some fairly strict requirements.</p>
<p>The purpose of this vignette is to provide an example of how to prepare input data for <code>cash_backtest</code>.</p>
</div>
<div id="input-data-requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#input-data-requirements" class="anchor"></a>Input Data Requirements</h2>
<div id="price-and-weight-matrixes" class="section level3">
<h3 class="hasAnchor">
<a href="#price-and-weight-matrixes" class="anchor"></a>Price and weight matrixes</h3>
<p><code>cash_backtest</code> requires two matrixes of identical dimensions. Both matrix’s first column needs to be a timestamp or date in Unix format.</p>
<p>The timestamp should be aligned with the weights and prices such that on a single row, the price is the price you assume you can trade into the weight at. This may require lagging of signals or weights upstream of the simulation and is up to the user. In another vignette, we provide an example of a simple workflow for lagging weights with respect to prices.</p>
<p>The first input matrix contains prices, one column for each asset or product in the strategy’s universe.</p>
<p>The second matrix contains theoretical or ideal weights, again, one column for each asset in the strategy’s universe.</p>
<p>Columns must map between the two matrixes: * Column 1 is always the date or timestamp column * Column 2 contains the prices and weights for the first asset * Column 3 contains the prices and weights for the second asset * <em>etc</em></p>
<p>Let’s run through an example of how you might wrangle such input data using tools from the tidyverse.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rsims</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co"># load("~/rsims/data/backtest_df_long.RData")</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">backtest_df_long</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 4</span>
<span class="co">#&gt; # Groups:   date [1]</span>
<span class="co">#&gt;   ticker date        price_usd theo_weight</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;date&gt;          &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 BTC    2015-04-22 234.              0.1 </span>
<span class="co">#&gt; 2 DASH   2015-04-22   3.24           -0.1 </span>
<span class="co">#&gt; 3 DGB    2015-04-22   0.000110       -0.06</span>
<span class="co">#&gt; 4 DOGE   2015-04-22   0.000109       -0.02</span>
<span class="co">#&gt; 5 LTC    2015-04-22   1.44            0.02</span>
<span class="co">#&gt; 6 MAID   2015-04-22   0.0233          0.18</span></code></pre></div>
<p>First, let’s assume you have a long dataframe consisting of columns for ticker, date, price, and weight:</p>
<p>How you arrived at the weights for each product for each day is up to you. <code>backtest_df_long</code> contains weights for a simple cross-sectional momentum strategy.</p>
<p>Recall that we need to end up with two wide matrixes of date and prices and date and weights, and that the columns of each matrix must map column-wise.</p>
<p>One easy way to do that is use <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">tidyr::pivot_wider</a></code>, which will guarantee that prices and weights will be mapped correctly:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">backtest_df</span> <span class="op">&lt;-</span> <span class="va">backtest_df_long</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">ticker</span>, values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">price_usd</span>, <span class="va">theo_weight</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">backtest_df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 37</span>
<span class="co">#&gt; # Groups:   date [6]</span>
<span class="co">#&gt;   date       price_usd_BTC price_usd_DASH price_usd_DGB price_usd_DOGE</span>
<span class="co">#&gt;   &lt;date&gt;             &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2015-04-22          234.           3.24      0.000110      0.000109 </span>
<span class="co">#&gt; 2 2015-04-23          236.           3.67      0.000119      0.000111 </span>
<span class="co">#&gt; 3 2015-04-24          231.           3.20      0.000133      0.000105 </span>
<span class="co">#&gt; 4 2015-04-25          226.           3.09      0.000122      0.0000997</span>
<span class="co">#&gt; 5 2015-04-26          221.           3.05      0.000123      0.0000976</span>
<span class="co">#&gt; 6 2015-04-27          227.           2.98      0.000120      0.000105 </span>
<span class="co">#&gt; # … with 32 more variables: price_usd_LTC &lt;dbl&gt;, price_usd_MAID &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price_usd_VTC &lt;dbl&gt;, price_usd_XEM &lt;dbl&gt;, price_usd_XMR &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price_usd_XRP &lt;dbl&gt;, price_usd_ETH &lt;dbl&gt;, price_usd_XLM &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price_usd_DCR &lt;dbl&gt;, price_usd_LSK &lt;dbl&gt;, price_usd_ETC &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price_usd_REP &lt;dbl&gt;, price_usd_ZEC &lt;dbl&gt;, price_usd_WAVES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   theo_weight_BTC &lt;dbl&gt;, theo_weight_DASH &lt;dbl&gt;, theo_weight_DGB &lt;dbl&gt;,</span>
<span class="co">#&gt; #   theo_weight_DOGE &lt;dbl&gt;, theo_weight_LTC &lt;dbl&gt;, theo_weight_MAID &lt;dbl&gt;, …</span></code></pre></div>
<p>From this point, we can split our single wide matrix into two matrixes. Note that since matrixes must hold a common data type, our date column will be converted to a Unix-style timestamp.</p>
<p>First, the weights matrix, which will have some <code>NA</code> values where we didn’t have a weight for an asset on a particular day in our long dataframe. It makes sense to replace these with zero.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get weights as a wide matrix</span>
<span class="co"># note that date column will get converted to unix timestamp</span>
<span class="va">backtest_theo_weights</span> <span class="op">&lt;-</span> <span class="va">backtest_df</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"theo_weight_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># NA weights should be zero</span>
<span class="va">backtest_theo_weights</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">backtest_theo_weights</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">backtest_theo_weights</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       date theo_weight_BTC theo_weight_DASH theo_weight_DGB theo_weight_DOGE</span>
<span class="co">#&gt; [1,] 16547            0.10            -0.10           -0.06            -0.02</span>
<span class="co">#&gt; [2,] 16548            0.14            -0.06           -0.10             0.06</span>
<span class="co">#&gt; [3,] 16549            0.14            -0.10            0.10            -0.06</span>
<span class="co">#&gt; [4,] 16550            0.10            -0.10            0.06            -0.06</span>
<span class="co">#&gt; [5,] 16551            0.06            -0.06            0.14            -0.02</span></code></pre></div>
<p>We do the same thing for our prices, but this time where an asset didn’t have a price (for example because it wasn’t in existence on particular day), we leave the existing <code>NA</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get prices as a wide matrix</span>
<span class="co"># note that date column will get converted to unix timestamp</span>
<span class="va">backtest_prices</span> <span class="op">&lt;-</span> <span class="va">backtest_df</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"price_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">backtest_prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       date price_usd_BTC price_usd_DASH price_usd_DGB price_usd_DOGE</span>
<span class="co">#&gt; [1,] 16547      233.8224       3.241223  0.0001098965   1.091501e-04</span>
<span class="co">#&gt; [2,] 16548      235.9333       3.667605  0.0001194309   1.113668e-04</span>
<span class="co">#&gt; [3,] 16549      231.4586       3.203421  0.0001334753   1.046427e-04</span>
<span class="co">#&gt; [4,] 16550      226.4460       3.093542  0.0001222808   9.972296e-05</span>
<span class="co">#&gt; [5,] 16551      220.5034       3.054431  0.0001227349   9.762035e-05</span></code></pre></div>
<p>At this point, we are ready to simulate trading according to our weights:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulation parameters</span>
<span class="va">initial_cash</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="va">capitalise_profits</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>  <span class="co"># remain fully invested?</span>
<span class="va">trade_buffer</span> <span class="op">&lt;-</span> <span class="fl">0.</span>
<span class="va">commission_pct</span> <span class="op">&lt;-</span> <span class="fl">0.</span>

<span class="co"># simulation</span>
<span class="va">results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cash_backtest.html">cash_backtest</a></span><span class="op">(</span>
  <span class="va">backtest_prices</span>, 
  <span class="va">backtest_theo_weights</span>, 
  <span class="va">trade_buffer</span>, 
  <span class="va">initial_cash</span>, 
  <span class="va">commission_pct</span>, 
  <span class="va">capitalise_profits</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">results_df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 8</span>
<span class="co">#&gt;   ticker         Date            Close Position Value  Trades TradeValue Commission</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;date&gt;          &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Cash           2015-04-22   1          1   e4 10000 NA              NA          0</span>
<span class="co">#&gt; 2 price_usd_BTC  2015-04-22 234.         4.28e0  1000  4.28e0       1000          0</span>
<span class="co">#&gt; 3 price_usd_DASH 2015-04-22   3.24      -3.09e2 -1000 -3.09e2      -1000          0</span>
<span class="co">#&gt; 4 price_usd_DGB  2015-04-22   0.000110  -5.46e6  -600 -5.46e6       -600          0</span>
<span class="co">#&gt; 5 price_usd_DOGE 2015-04-22   0.000109  -1.83e6  -200 -1.83e6       -200          0</span>
<span class="co">#&gt; 6 price_usd_LTC  2015-04-22   1.44       1.39e2   200  1.39e2        200          0</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'glue'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse</span>

<span class="va">equity_curve</span> <span class="op">&lt;-</span> <span class="va">results_df</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>Equity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> 

<span class="va">fin_eq</span> <span class="op">&lt;-</span> <span class="va">equity_curve</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Equity</span><span class="op">)</span>

<span class="va">init_eq</span> <span class="op">&lt;-</span> <span class="va">equity_curve</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Equity</span><span class="op">)</span>

<span class="va">total_return</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">fin_eq</span><span class="op">/</span><span class="va">init_eq</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="va">days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">equity_curve</span><span class="op">)</span>
<span class="va">ann_return</span> <span class="op">&lt;-</span> <span class="va">total_return</span> <span class="op">*</span> <span class="fl">365</span><span class="op">/</span><span class="va">days</span>
<span class="va">sharpe</span> <span class="op">&lt;-</span> <span class="va">equity_curve</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>returns <span class="op">=</span> <span class="va">Equity</span><span class="op">/</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">Equity</span><span class="op">)</span><span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>sharpe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">355</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">equity_curve</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Equity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"Momentum Backtest - Cash Accounting"</span>,
      subtitle <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span>
        <span class="st">"Momentum backtest, costs {commission_pct*100}% trade value, trade buffer = {trade_buffer}, trade on close
        {round(total_return, 1)}% total return, {round(ann_return, 1)}% annualised, Sharpe {round(sharpe, 2)}"</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Wrangling-data-for-input-to-simulation-engine_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kris Longmore-Dodd.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
